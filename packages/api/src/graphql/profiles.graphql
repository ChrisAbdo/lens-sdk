fragment MediaFields on Media {
  url
  mimeType
}

fragment MediaSet on MediaSet {
  original {
    ...MediaFields
  }
}

fragment FeeFollowModuleSettings on FeeFollowModuleSettings {
  __typename
  amount {
    ...ModuleFeeAmount
  }
  contractAddress
  recipient
}

fragment ProfileFollowModuleSettings on ProfileFollowModuleSettings {
  __typename
  contractAddress
}

fragment RevertFollowModuleSettings on RevertFollowModuleSettings {
  __typename
  contractAddress
}

fragment ProfileMediaFields on ProfileMedia {
  ... on NftImage {
    contractAddress
    tokenId
    uri
    verified
  }

  ... on MediaSet {
    ...MediaSet
  }
}

fragment Attribute on Attribute {
  __typename
  key
  value
}

fragment ProfileFields on Profile {
  id
  name
  bio
  handle
  ownedBy
  attributes {
    ...Attribute
  }
  picture {
    ...ProfileMediaFields
  }
  coverPicture {
    ...ProfileMediaFields
  }
  stats {
    totalFollowers
    totalFollowing
    totalPosts
  }
  followModule {
    ... on FeeFollowModuleSettings {
      ...FeeFollowModuleSettings
    }

    ... on ProfileFollowModuleSettings {
      ...ProfileFollowModuleSettings
    }

    ... on RevertFollowModuleSettings {
      ...RevertFollowModuleSettings
    }
  }
  dispatcher {
    address
    canUseRelay
  }

  isFollowedByMe(isFinalisedOnChain: true)
  # isFollowing(who: $activeProfileId) //TODO: active profile id for read queries?
}

query ProfilesToFollow {
  recommendedProfiles {
    ...ProfileFields
  }
}

query GetProfileByHandle($handle: Handle!) {
  result: profile(request: { handle: $handle }) {
    ...ProfileFields
  }
}

query GetProfileById($id: ProfileId!) {
  result: profile(request: { profileId: $id }) {
    ...ProfileFields
  }
}
